# OPC UA Server & Client for CNC with UAModeler Model

This project provides a complete solution for CNC machine simulation via OPC UA, including a Node.js **server** and **client**, and the **OPC UA model definition files generated by UAModeler**.

-----

## Project Contents

  * **`server.js`**:

      * Implements an **OPC UA server** based on `node-opcua`.
      * Defines a hierarchical model for CNC machines (`MacchinaCNCType`, `MacchinaCNCProType` which extends the base, and `MandrinoType` as a component).
      * Exposes variables such as `Status`, `Utensile` (Tool), `PezziProdotti` (Produced Parts), `ConsumoEnergetico` (Energy Consumption), and `StatusAI` (for Pro versions).
      * Offers callable methods: `ChangeStatus` (for the CNC), `CambiareVelocita` (Change Speed, for the Spindle, with validation based on CNC status), and `ManutenzionePredittiva` (Predictive Maintenance, for the CNC Pro).

  * **`client.js`**:

      * A separate **OPC UA client** (Node.js) that connects to the `server.js`.
      * Performs Address Space *Browse* to discover CNC machine instances.
      * Configures *subscriptions* to monitor real-time changes to key variables (`Status`, `ConsumoEnergetico`, `Velocita` of the Spindle, `StatusAI`).
      * Demonstrates interaction with the server by *calling methods* (`ChangeStatus`, `CambiareVelocita`, `ManutenzionePredittiva`).

  * **OPC UA Model Files (from UAModeler)**:

      * These files are typically generated or used by **UAModeler** and describe the formal structure of the OPC UA model, facilitating visualization and engineering:
          * `CNC.tt2pro`: The main UAModeler project file.
          * `CNC.uap`: Another UAModeler project/intermediate file.
          * `cnc.ua`: The **NodeSet2 XML** of the OPC UA model, a standard format for import and export between different OPC UA tools and servers.
          * `cnc.bsd`, `cnc.xsd`: Binary and XML schemas for any complex data types used in the model.

-----

## Prerequisites

  * **For Node.js Server and Client**:
      * [Node.js](https://nodejs.org/) (version 14 or higher recommended)
      * [npm](https://www.npmjs.com/) (Node Package Manager, included with Node.js)
  * **For UAModeler Model**:
      * [UAModeler](https://www.unified-automation.com/products/development-tools/uamodeler.html) or an OPC UA model viewer compatible with NodeSet2 XML.

-----

## Installation

1.  **Clone the repository** or download all files (`server.js`, `client.js`, and the `CNC.*`, `cnc.*` UAModeler files) into a single folder.
2.  **Install Node.js dependencies**. Open your terminal in the project folder and run:
    ```bash
    npm install node-opcua
    ```

-----

## Usage

### 1\. Start the OPC UA Server

Open your **first terminal window** and start the server:

```bash
node server.js
```

The server will start and listen on the endpoint: `opc.tcp://localhost:4334/UA/CNC`. CNC machine instances will be created.

### 2\. Start the OPC UA Client

Open a **second terminal window** and start the client:

```bash
node client.js
```

The client will connect to the server, read the initial state of the machines, set up subscriptions to monitor changes, and call the demonstration methods. You will observe output in both terminal windows, showing the interaction between the client and server.

### 3\. View the Model with UAModeler

To explore the detailed structure of the OPC UA model (ObjectTypes, variables, methods, relationships), open the `CNC.tt2pro` file directly in UAModeler. Alternatively, you can import the `cnc.ua` file (NodeSet2 XML) into any other modeling tool or advanced OPC UA client.

### Diagram
![CNC](https://github.com/user-attachments/assets/ecb5e5e7-79a6-4885-90a0-d43cefc5deab)

-----
